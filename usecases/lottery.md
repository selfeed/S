lottery
======

中文版本
----------

现实中的彩票，往往存在很多猫腻，总有人刚好50注清空奖池，开奖不公开不透明，甚至出现开奖视频与开奖结果不一致的丑闻。实际上，这里有一种纯技术的解决方案：一种P2P的彩票方案。简单起见，这里利用比特币现有机制为基础给出一个可实际操作的方案。



比特币天生已经是公开的账本，我们通过转账来下注，这样彩票本身就不能伪造或抵赖，我们需要的杜绝彩票结果。那么这个结果必定不能是官方或者所谓的代表团给出的，必须由所有彩民共同决定，这必须是一个中立的算法，需要满足：

1: 完全公开；

2: 一定时间内每个彩民都能根据全部彩票信息计算出同样的结果；

3: 投票周期内用全部的计算能力也不可能计算出来结果，或关于结果的有价值信息；

4: 最后一个投票者无法选择结果或中奖优势；

5: 彩民投注后可以不上线；不影响计算；

6: 公布的结果每个彩民都可以快速复算。


问题的核心就在于找到一个不可并行优化的耗时算法，连续迭代N次sha256运算既可满足。

算法详细如下：

一轮彩票的投注阶段结束后

总摘要=sha256(交易链顺序排列的彩票序列）

结果摘要=迭代N次sha256（初始种子=总摘要）

中奖号码= 映射成彩票号码（结果摘要 整除 全部彩票号码种类数）



N 为当前时代最高性能的计算设备在投注窗口时间内能进行的串行sha256运算次数的一定倍数，比如三倍。

中间摘要 = 每一阶段迭代中间值的列表

整个过程如下：

1: 一轮投注时间窗内，彩民通过比特币转账认购彩票，只需要填写自己中意的彩票即可

2: 投注截止后，大家都可以计算结果，性能最优的cpu最先公布结果和中间摘要

3: 各彩民可以根据中间摘要利用并行运算在很短的时间验证结果

4: 无人质疑后主办方即可按结果支付奖金和退还无效投注。


我们来分析下作弊的可能性：

主办方：

        在整个机制中只承担公共信用账号责任，无干预投注开奖特权。

最后投票者：

        虽然最后投票者对于最终摘要有一定选择权，但是投票者无法直接选择最终结果。但是否投票者能尝试到一个已知的总摘要呢？假定全球100亿人每人有1P存储，1THz 算力 全都用来攻击，不考虑单位，最多可以存储2^84的总摘要到中奖号码的表，最多每秒计算2^74次总摘要，那也需要2^98秒才能获得一次有效碰撞，这个时间宇宙都毁灭上亿次了。

       补充一点，计算总摘要的算法如果换成“总摘要=sha256(按大小排序的彩票序列）”会存在严重漏洞，因为排序会归并大量状态，最后一个玩家可以通过补充大量的票达到一个每种彩票既定数量的状态，排序后结果既定，从而达到一个既定的总摘要值。

公布计算结果者：

        公布一个错误的结果的话，由于可以根据中间摘要按区段并行验算，他人可以用百分之一的时间来验证是否错误，还是老老实实算完，拿首算奖励吧。


现有比特币彩票很多种，我们分析下典型的作为对比:

1:比特币强力球，按美国强力球结果开奖，返奖率高。从算法而言，依赖外界因素，
当运作到一定规模，同样可能存在内幕人士中奖的可能。

2:B52中本聪彩票网，hash值最接近下一比特币区块hash的中奖，
这个存在很多bug，首先存在联合矿主选择有利结果作弊的可能，最重要的时候后投注者有非常大的优势，
假定有已经有一注，后投注者可以选择投一注使得hash略小点，
如果有一万注，那就投一万注占住靠前的位置，由于巨大的hash值空间，这样后投者具有巨大的优势。

3:某种彩票，猜测下一次产生新比特币需要的时间，同样存在联合矿场操纵结果的可能，也存在抢占空档区的后发优势。




该思想最大的意义就是在虚拟世界中引入了绝对时间！

该思想可能被用于彩票、公益基金的回馈、赌博、遗嘱、定期自动解密的档案等等机制。


以档案为例：
# 档案


档案最终需要公开，又要有一定的时效性，在彩票方案中我们已经看到了迭代摘要作为一种固定时间保密的手段，但是我们看到加密的时间等于解密的时间，如果要加密五十年的档案，就得提前五十年准备，不具备可行性。但是只要一些小手段，就可以实现短时间内完成准备动作，算法详细定义如下：

算法目标：

       在1天内准备好一份需要50年自动解密的档案

设定：

       N = 一天内最多迭代摘要运算次数

步骤：

     准备18263个随机数作为种子集合

     并发对所有种子分别执行N次迭代摘要，得到18263个迭代结果集合

     然后对每一个迭代种子用上一次的迭代结果加密得到 18263个数字

     用最后一个数字作为密钥对档案加密，公布其他的数字和第一个随机数字

解密：

     无额外信息的话，必须一步步解密，需18263天，即50年




